{"version":3,"file":"ng-gapi.js","sources":["../../src/config/GoogleApiConfig.ts","../../src/GoogleApiService.ts","../../src/GoogleAuthService.ts","../../src/GoogleApiModule.ts","../../src/ng-gapi.ts"],"sourcesContent":["import ClientConfig = gapi.auth2.ClientConfig;\n\nexport interface NgGapiClientConfig extends ClientConfig {\n  discoveryDocs: string[];\n}\n\nexport class GoogleApiConfig {\n  protected clientConfig: NgGapiClientConfig;\n\n  constructor(clientConfig: NgGapiClientConfig) {\n    this.clientConfig = clientConfig;\n  }\n\n  public getClientConfig(): NgGapiClientConfig {\n    return this.clientConfig;\n  }\n}\n","import {Inject, Injectable, InjectionToken} from '@angular/core';\nimport {GoogleApiConfig, NgGapiClientConfig} from './config/GoogleApiConfig';\nimport {Observable, Observer} from 'rxjs';\n\nexport let NG_GAPI_CONFIG: InjectionToken<NgGapiClientConfig> =\n  new InjectionToken<NgGapiClientConfig>('ng-gapi.config');\n\n@Injectable()\nexport class GoogleApiService {\n  private readonly gapiUrl: string = 'https://apis.google.com/js/api.js';\n  private config: GoogleApiConfig;\n  private gapiLoaded: boolean;\n  private node: HTMLScriptElement;\n  private observers: Observer<boolean>[] = [];\n\n  constructor(@Inject(NG_GAPI_CONFIG) config: NgGapiClientConfig) {\n    this.config = new GoogleApiConfig(config);\n    this.loadGapi().subscribe();\n  }\n\n  public onLoad(): Observable<boolean> {\n    return this.loadGapi();\n  }\n\n  public getConfig(): GoogleApiConfig {\n    return this.config;\n  }\n\n  private loadGapi(): Observable<boolean> {\n    return new Observable((observer: Observer<boolean>) => {\n      if (this.gapiLoaded) {\n        observer.next(true);\n        observer.complete();\n      } else if (!this.node) {\n        /**\n         * script element has not yet been added to document\n         */\n        this.node = document.createElement('script');\n        this.node.async = true;\n        this.node.src = this.gapiUrl;\n        this.node.type = 'text/javascript';\n        this.node.onload = () => {\n          this.gapiLoaded = true;\n          while (this.observers.length) {\n            const observer = this.observers.shift();\n            observer.next(true);\n            observer.complete();\n          }\n          this.node = undefined;\n        };\n        this.node.onerror = () => {\n          this.node = undefined;\n        }\n        document.getElementsByTagName('head')[0].appendChild(this.node);\n      } else {\n        /**\n         * script is in the middle of being loaded\n         */\n        this.observers.push(observer);\n      }\n    });\n  }\n}\n","import {Injectable, Inject} from '@angular/core';\nimport {GoogleApiService} from './GoogleApiService';\nimport GoogleAuth = gapi.auth2.GoogleAuth;\nimport {Observable, Observer, of} from 'rxjs';\nimport {mergeMap} from 'rxjs/operators';\n\n@Injectable()\nexport class GoogleAuthService {\n  private GoogleAuth: GoogleAuth = undefined;\n\n  constructor(@Inject(GoogleApiService) private googleApi: GoogleApiService) {\n    this.googleApi.onLoad().subscribe(() => {\n      this.loadGapiAuth().subscribe();\n    });\n  }\n\n  public getAuth(newInstance = false): Observable<GoogleAuth> {\n    if (!this.GoogleAuth || newInstance) {\n      return this.googleApi.onLoad()\n        .pipe(mergeMap(() => this.loadGapiAuth()));\n    }\n    return of(this.GoogleAuth);\n  }\n\n  private loadGapiAuth(): Observable<GoogleAuth> {\n    return new Observable((observer: Observer<GoogleAuth>) => {\n      gapi.load('auth2', () => {\n        gapi.auth2.init(this.googleApi.getConfig().getClientConfig()).then((auth: GoogleAuth) => {\n          this.GoogleAuth = auth;\n          observer.next(auth);\n          observer.complete();\n        }).catch((err: any) => observer.error(err));\n      });\n    });\n  }\n}\n","import {ModuleWithProviders, NgModule, Provider} from '@angular/core';\nimport {GoogleAuthService} from './GoogleAuthService';\nimport {GoogleApiService} from './GoogleApiService';\n\n@NgModule()\nexport class GoogleApiModule {\n  static forRoot(gapiConfigProvider: Provider): ModuleWithProviders<GoogleApiModule> {\n    return {\n      ngModule: GoogleApiModule,\n      providers: [\n        gapiConfigProvider,\n        GoogleAuthService,\n        GoogleApiService\n      ]\n    };\n  }\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}